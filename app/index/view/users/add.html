
{extend name='public/base' /}
{block name='content'}

<section class="content">
    <div class="container-fluid">
        <!--sub page--->
        <div class="card card-primary card-outline card-outline-tabs">
            <div class="card-body">
                <form id="test_form" class="form-horizontal" action="{notempty name="userinfo"}{:url('index',['act'=>'update','uid'=>$userinfo.uid])}{else /}{:url('index',['act'=>'update','uid'=>0])}{/notempty}" method="post">


                <div class="form-group row">
                        <div class="col-11">
                            <a class="btn flat btn-sm btn-default BackButton" href="{:url('index')}">
                                <i class="fa fa-arrow-left"></i>
                                返回
                            </a>
                        </div>

                        <div class="col-auto">
                            <button id="submit" class="btn btn-info" type="submit">
                                <i class="icon-ok bigger-110"></i>
                                提交
                            </button>
                        </div>
                    </div>

                <div class="form-group row pt-2" style="align-items: baseline;">
                        <div class="col-xs-12 col-md-4">
                            <div class="form-group row">
                                <label class="col-md-3 control-label" for="code">編號</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="code" name="code"
                                           value="{$userinfo.code ?? ''}"
                                          >
                                </div>
                            </div>


 <!--                            <div class="form-group row">
                                <label class="col-md-3 control-label" for="grade">級別</label>
                                <div class="col-md-7">
                                    <select class="form-control select2" type="text" id="grade" name="grade">
                                        <option value="">&nbsp;</option>
                                        {foreach name=":getOptions('grade')" id='opt'}
                                        <option value="{$opt.val}" {if isset($item) &&
                                                $item.grade==$opt.val}selected{/if}>
                                            {$opt.name}
                                        </option>
                                        {/foreach}
                                    </select>
                                </div>
                            </div> -->

                               <div class="form-group row">
                                <label class="col-md-3 control-label" for="ugid">級別</label>
                                <div class="col-md-7">
                                    <select class="form-control" id="ugid" name="ugid" size="1"
                                            value="{$userinfo.ugid ?? ''}">

                                        <option value="0"></option>
                                        {notempty name="group"}
                                        {volist name="group" id="val"}
                                        <option value="{$val.id}" {if isset($userinfo) && $val.id == $userinfo.ugid} selected {/if}>{$val.title}</option>
                                        {/volist}
                                        {/notempty}
                                    </select>
                                </div>
                            </div>

                            <div class="form-group row">
                                <label class="col-md-3 control-label" for="last_name">名稱(中文)</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="last_name" name="last_name"
                                           value="{$userinfo.last_name ?? ''}"
                                           >
                                </div>
                            </div>

                            <div class="form-group row">
                                <label class="col-md-3 control-label" for="first_name">名稱(英文)</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="first_name" name="first_name"
                                           value="{$userinfo.first_name ?? ''}"
                                           >
                                </div>
                            </div>

                            <div class="form-group row">
                                <label class="col-md-3 control-label" for="for_short">名稱(簡稱)</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="for_short" name="for_short"
                                           value="{$userinfo.for_short ?? ''}"
                                           >
                                </div>
                            </div>


                            <div class="form-group row">
                                <label class="col-md-3 control-label" for="sex">性別</label>
                                <div class="col-md-7">
                                    <select class="form-control" id="sex" name="sex" size="1"
                                            value="{$userinfo.sex ?? ''}">
                                         <option value="保密" {if isset($userinfo)&&$userinfo.sex == 0} selected {/if}>保密</option>
                                        <option value="男" {if isset($userinfo)&&$userinfo.sex == 1} selected {/if}>男</option>
                                        <option value="女" {if isset($userinfo)&&$userinfo.sex == 2} selected {/if}>女</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group row">
                                <label class="col-md-3 control-label" for="birthday">出生日期</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="birthday" name="birthday"
                                           value="{$userinfo.birthday ?? ''}"
                                          >
                                </div>
                            </div>

                            <div class="form-group row">
                                <label class="col-md-3 control-label" for="identity_card">身份證號碼</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="identity_card" name="identity_card"
                                           value="{$userinfo.identity_card ?? ''}"
                                           >
                                </div>
                            </div>

                        </div>


                        <div class="col-xs-12 col-md-4">
                            <div class="form-group row">
                                <label class="col-md-3 control-label"
                                       for="marital_status">婚姻狀況</label>
                                <div class="col-md-7">
                                    <select class="form-control" id="marital_status" name="marital_status" size="1"
                                            value="{$userinfo.marital_status ?? ''}">
                                        <option value="0" {if isset($userinfo) && 0 == $userinfo.marital_status} selected {/if}>單身</option>
                                        <option value="1" {if isset($userinfo) && 1 == $userinfo.marital_status} selected {/if}>已婚</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group row">
                                <label class="col-md-3 control-label" for="phone_mobile">手提電話</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="phone_mobile"
                                           name="phone_mobile"
                                           value="{$userinfo.phone_mobile ?? ''}"
                                          >
                                </div>
                            </div>


                            <div class="form-group row">
                                <label class="col-md-3 control-label" for="phone_work">住宅電話</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="phone_work" name="phone_work"
                                           value="{$userinfo.phone_work ?? ''}"
                                           >
                                </div>
                            </div>

                            <div class="form-group row">
                                <label class="col-md-3 control-label" for="region">傳真號碼</label>
                                <div class="col-md-7">
                                    <input class="form-control js-datepicker" type="text" id="region"
                                           name="region"  value="{$userinfo.region ?? ''}"
                                           >
                                </div>
                            </div>


                            <div class="form-group row">
                                <label class="col-md-3 control-label" for="email">電郵地址</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="email" id="email" name="email"
                                           value="{$userinfo.email ?? ''}"
                                           >
                                </div>
                            </div>

                            <div class="form-group row">
                                <label class="col-md-3 control-label" for="expiry_date">地址</label>
                                <div class="col-md-7">
                            <textarea class="form-control" id="expiry_date" name="expiry_date"
                                      size="1"
                                      value=""
                                      {$userinfo.expiry_date ?? ''}">{$userinfo.expiry_date ?? ''}</textarea>
                                </div>
                            </div>



                            <div class="form-group row">
                                <label class="col-md-3 control-label" for="remark">備註</label>
                                <div class="col-md-7">
                            <textarea class="form-control" id="remark" name="remark"
                                      size="1"
                                      value=""
                                     {$userinfo.remark ?? ''}">{$userinfo.remark ?? ''}</textarea>
                                </div>
                            </div>


                        </div>


                        <div class="col-xs-12 col-md-4">
                            <table width="83%" id="table" style="margin-bottom: 4%">
                                <tr>
                                    <td colspan="9" class="border-b-double">
                                        <label>職位信息</label>
                                    </td>
                                </tr>
                                <tr bgcolor="#ced4da">
                                    <td colspan="9">
                                        <a title="刪除" onclick="delDuty()" class="btn btn-default btn-sm " href="#">刪除</a>

                                        <a title="新增" onclick="add_duty()" class="btn btn-default btn-sm " href="#" id="old_item">新增</a>

                                    </td>
                                </tr>

                                <tr bgcolor="#e9ecef">
                                    <th width="5%"></th>
                                    <th width="5%"></th>
                                    <!--                                <th width="12%">現時</th>-->
                                    <th width="20%">日期</th>
                                    <th width="12%">職位</th>
                                </tr>

                                {notempty name="dutyInfo"}
                                    {volist name="dutyInfo" id="dutys" key="index"}
                                <tr class="duty">
                                    <td width="5%"></td>
                                    <td width="5%">
                                        <input type="hidden" name="item[{$index-1}][user_id]" value="">
                                        <input type="hidden" name="item[{$index-1}][id]" value="{$userinfo.uid}">
                                        {if condition="$userinfo.category eq $dutys.duty && $userinfo.date_of_accession eq $dutys.entry_date"}
                                        <i class="fa fa-info-circle"></i>
                                        {/if}
                                    </td>
                                    <td width="20%">
                                        <input class="form-control form-control-sm" type="text"
                                               name="item[{$index-1}][entry_date]"
                                               id="duty{$index-1}"
                                               value="{$dutys.entry_date}"
                                               style="width: 80%" readonly="readonly">
                                    </td>
                                    <td width="12%">
                                        <input type="hidden" name="item[{$index-1}][duty]" value="{$dutys.duty}">
                                        <select name="item[{$index-1}][duty]" class="form-control" disabled="disabled">
                                            <option value=""></option>
                                            {volist name="dutyArr" id="duty"}
                                            <option value="{$key}" {if $dutys.duty == $key} selected {/if}>{$duty}</option>
                                            {/volist}
                                        </select>
                                    </td>
                                </tr>
                                {/volist}
                                {else /}
                                <tr class="duty">
                                    <td width="5%"></td>
                                    <td width="5%">
                                        <input type="hidden" name="item[0][user_id]" value="">
                                    </td>
                                    <td width="20%">
                                        <input class="form-control form-control-sm datePicker" type="text"
                                               name="item[0][entry_date]"
                                               id="duty0"
                                               value=""
                                               style="width: 80%">
                                    </td>
                                    <td width="12%">
                                        <select name="item[0][duty]" class="form-control">
                                            <option value=""></option>
                                            {volist name="dutyArr" id="duty"}
                                            <option value="{$key}">{$duty}</option>
                                            {/volist}
                                        </select>
                                    </td>
                                </tr>
                                {/notempty}
                            </table>


                            <div class="form-group row">
                                <label class="col-md-3 control-label" for="shop">狀態</label>
                                <div class="col-md-7">
                                    <select class="form-control" id="shop" name="shop" size="1"
                                            value="{$userinfo.shop ?? ''}">
                                        <option value="可登入" {if isset($userinfo) && 0 == $userinfo.shop} selected {/if}>可登入</option>
                                        <option value="停用" {if isset($userinfo) && 1 == $userinfo.shop} selected {/if}>停用</option>
                                    </select>
                                </div>
                            </div>


                            <div class="form-group row">
                                <label class="col-md-3 control-label" for="source">顯示語言</label>
                                <div class="col-md-7">
                                    <select class="form-control" id="source" name="source"
                                            size="1" value="{$userinfo.source ?? ''}">
                                        <option value="繁體中文" {if isset($userinfo) && 0 == $userinfo.source} selected {/if}>繁體中文</option>
                                        <option value="English" {if isset($userinfo) && 1 == $userinfo.source} selected {/if}>English</option>

                                    </select>
                                </div>
                            </div>

                            <div class="form-group row">
                                <label class="col-md-3 control-label" for="username">使用者名稱</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="username" name="username"
                                           value="{$userinfo.username ?? ''}"
                                           >
                                </div>
                            </div>




                            <div class="form-group row">
                                <label class="col-md-3 control-label" for="new_password">新密碼</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="new_password" name="password"
                                           value="{$userinfo.new_password ?? ''}"
                                           >
                                </div>
                            </div>


                            <div class="form-group row">
                                <label class="col-md-3 control-label">店鋪</label>
                                <div class="col-md-7">
                                    <select name="store" id="store_id" class="form-control" multiple="multiple">
                                        <option value=""></option>
                                        {volist name="storeArr" id="store"}
                                        <option value="{$store.id}" {if isset($userinfo) && $userinfo.store_id == $store.id} selected {/if}>{$store.name}</option>
                                        {/volist}
                                    </select>
                                </div>
<!--                                <input type="hidden" name="store_id" id="store" value="{$data.store_id|default=''}">-->
                            </div>

                        </div>
                    </div>

                <div class="row pt-2">
                    <div class="col-xs-12 col-md-4">

<!--                        <table width="100%" id="table">-->
<!--                            <tr>-->
<!--                                <td colspan="9" class="border-b-double">-->
<!--                                    <label>職位信息</label>-->
<!--                                </td>-->
<!--                            </tr>-->
<!--                            <tr bgcolor="#ced4da">-->
<!--                                <td colspan="9">-->
<!--                                    <a title="刪除" onclick="delDuty()" class="btn btn-default btn-sm " href="#">刪除</a>-->

<!--                                    <a title="新增" onclick="add_duty()" class="btn btn-default btn-sm " href="#" id="old_item">新增</a>-->


<!--                                </td>-->
<!--                            </tr>-->

<!--                            <tr bgcolor="#e9ecef">-->
<!--                                <th width="5%"></th>-->
<!--                                <th width="5%"></th>-->
<!--&lt;!&ndash;                                <th width="12%">現時</th>&ndash;&gt;-->
<!--                                <th width="20%">日期</th>-->
<!--                                <th width="12%">職位</th>-->
<!--                            </tr>-->

<!--                            <tr class="duty">-->
<!--                                <td width="5%"></td>-->
<!--                                <td width="5%">-->
<!--                                    <input type="hidden" name="item[0][user_id]" value="">-->
<!--                                </td>-->
<!--                                <td width="20%">-->
<!--                                    <input class="form-control form-control-sm datePicker" type="text"-->
<!--                                           name="item[0][entry_date]"-->
<!--                                           id="duty0"-->
<!--                                           value=""-->
<!--                                            style="width: 80%">-->
<!--                                </td>-->
<!--                                <td width="12%">-->
<!--                                    <select name="item[0][duty]" class="form-control">-->
<!--                                        <option value=""></option>-->
<!--                                        {volist name="dutyArr" id="duty"}-->
<!--                                        <option value="{$key}">{$duty}</option>-->
<!--                                        {/volist}-->
<!--                                    </select>-->
<!--                                </td>-->
<!--                            </tr>-->
<!--                        </table>-->
                    </div>
                </div>

                </form>
            </div>
            <!-- /.card -->
        </div>


    </div><!--/. container-fluid -->
</section>

{/block}
{block name="js"}
<script type="text/javascript">
    let store_id = "";
    $(document).ready( function (){
        $("#store_id").select2();
        // 编辑页面则将$("#store_id").val().split(',');
    });

    $(document).on("change", "#store_id", function () {
        store_id = $("#store_id").val().join(",");
        $("#store").val(store_id);
    });

    function delDuty() {
        $(".checkbox:checked").each(function () {
            $(this).parents('tr').remove();
        });

    }
    //新增按鈕
    function add_duty() {
        let index = $(".duty").length;
        console.log(index);
        let node = "";
        node = '<tr class="duty"><td width="5%"><input type="checkbox" class="checkbox"></td>\n' +
            '                                <td width="5%"><input type="hidden" name="item['+index+'][user_id]" value=""></td>\n' +
            '                                <td width="20%">\n' +
            '                                    <input id="duty'+index+'" class="form-control form-control-sm datePicker" type="text"\n' +
            '                                            name="item['+index+'][entry_date]"\n' +
            '                                           value=""\n' +
            '                                           ="" style="width: 80%">\n' +
            '                                </td>\n' +
            '                                <td width="12%">\n' +
            '                                    <select name="item['+index+'][duty]" class="form-control">\n' +
            '                                        <option value=""></option>\n' +
            '                                        {volist name="dutyArr" id="duty"}\n' +
            '                                        <option value="{$key}">{$duty}</option>\n' +
            '                                        {/volist}\n' +
            '                                    </select>\n' +
            '                                </td></tr>';
        $("#table").append(node);


            $('#duty' + index).datePicker({format: 'yyyy-mm-dd'});


    }

</script>
{/block}






