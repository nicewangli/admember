{extend name='public/layer_base' /}
{block name='content'}
        <!-- form content -->
        <section class="content">
            <div>
                <form class="form-horizontal" id="opportunitie-form" method="post" action="{$act}">

                    <input type="hidden" id="id" name="id" value="{$item.id|default=''}">

                    <div class="row pt-2">
                        <div class="col-xs-12 col-md-6">
                            <div class="form-group row ">
                                <label class="col-md-3 control-label" for="title">關於</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="title" name="title"
                                           value="{$item.title|default=''}"
                                           >
                                </div>
                            </div>


                            <div class="form-group row">
                                <label class="col-md-3 control-label" for="lead_id">Lead</label>
                                <div class="col-md-7 input-group input-group-sm">
                                    <input class="form-control form-control-sm" type="text" id="lead_name"
                                           value="{$item.lead_name|default=''}"
                                           >
                                    <input class="form-control form-control-sm" type="hidden" id="lead_id" name="lead_id"
                                           value="{$item.lead_id|default=''}"
                                           >
                                    <div class="input-group-append">
                                        <a class="input-group-text qs-lead"  href="javascript:void(0)" ><i class="fas fa-search"></i></a>
                                    </div>
                                </div>
                            </div>


                            <div class="form-group row ">
                                <label class="col-md-3 control-label" for="campaign_id">運動</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="campaign_id" name="campaign_id"
                                           value="{$item.campaign_id|default=''}"
                                           >
                                </div>
                            </div>

                            <div class="form-group row ">
                                <label class="col-md-3 control-label" for="status">狀態</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="status" name="status"
                                           value="{$item.status|default=''}"
                                           >
                                </div>
                            </div>

                            <div class="form-group row ">
                                <label class="col-md-3 control-label" for="sales_stage">階段</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="sales_stage" name="sales_stage"
                                           value="{$item.sales_stage|default=''}"
                                           >
                                </div>
                            </div>

                            <div class="form-group row ">
                                <label class="col-md-3 control-label" for="competitor1_id">競爭對手1</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="competitor1_id" name="competitor1_id"
                                           value="{$item.competitor1_id|default=''}"
                                           >
                                </div>
                            </div>

                            <div class="form-group row ">
                                <label class="col-md-3 control-label" for="competitor2_id">競爭對手2</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="competitor2_id" name="competitor2_id"
                                           value="{$item.competitor2_id|default=''}"
                                           >
                                </div>
                            </div>


                        </div>

                        <div class="col-xs-12 col-md-6">
                            <div class="form-group row ">
                                <label class="col-md-3 control-label" for="created_at">創建日期</label>
                                <div class="col-md-7">
                                    <input class="form-control js-datepicker" type="text" id="created_at"
                                           name="created_at" value="{$item.created_at|default=''}" data-date-format="yyyy-mm-dd">
                                </div>
                            </div>


                            <div class="form-group row ">
                                <label class="col-md-3 control-label" for="est_date_closed">預計截止日期</label>
                                <div class="col-md-7">
                                    <input class="form-control js-datepicker" type="text" id="est_date_closed"
                                           name="est_date_closed"  value="{$item.est_date_closed|default=''}" data-date-format="yyyy-mm-dd">
                                </div>
                            </div>

                            <div class="form-group row ">
                                <label class="col-md-3 control-label" for="date_closed">關閉日期 </label>
                                <div class="col-md-7">
                                    <input class="form-control js-datepicker" type="text" id="date_closed"
                                           name="date_closed"  value="{$item.date_closed|default=''}" data-date-format="yyyy-mm-dd">
                                </div>
                            </div>

                            <div class="form-group row ">
                                <label class="col-md-3 control-label" for="amount">銷售估算($)</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="amount" name="amount"
                                           value="{$item.amount|default=''}"
                                           >
                                </div>
                            </div>

                            <div class="form-group row ">
                                <label class="col-md-3 control-label" for="probability">銷售額 %</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="probability" name="probability"
                                           value="{$item.probability|default=''}"
                                           >
                                </div>
                            </div>

                            <div class="form-group row ">
                                <label class="col-md-3 control-label" for="company">組織 %</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="company" name="company"
                                           value="{$item.company|default=''}"
                                           >
                                </div>
                            </div>

                            <div class="form-group row ">
                                <label class="col-md-3 control-label" for="competitor3_id">競爭對手3</label>
                                <div class="col-md-7">
                                    <input class="form-control" type="text" id="competitor3_id" name="competitor3_id"
                                           value="{$item.competitor3_id|default=''}"
                                           >
                                </div>
                            </div>
                        </div>
                    </div>

<hr>
                    <div class="form-group row ">
                        <label class="col-sm-1 control-label" for="assigned_user_id">營業員</label>
                        <div class="col-sm-4">
                            <select class="form-control select2" type="text" id="assigned_user_id" name="assigned_user_id">
                                <option value="">&nbsp;</option>
                                {foreach name=":getUsers('account','assigned_user_id')" id='use'}
                                <option value="{$use.uid}" {if isset($item) &&
                                        $item.assigned_user_id==$use.uid}selected{/if}>
                                    {$use.name}
                                </option>
                                {/foreach}
                            </select>
                        </div>



                        <label class="col-sm-1 control-label" for="visible_for"> 權限</label>
                        <div class="col-sm-4">
                            <select class="form-control select2" type="text" id="visible_for" name="visible_for">
                                <option value="">&nbsp;</option>
                                {foreach name=":getOptions('visible_for')" id='opt'}
                                <option value="{$opt.val}" {if isset($item) &&
                                        $item.visible_for==$opt.val}selected{/if}>
                                    {$opt.name}
                                </option>
                                {/foreach}
                            </select>
                        </div>


                    </div>
                </form>
            </div>

            <hr>
            <div class="col-md-12" align="center">
                <button id="opportunitie-submit" type="button" class=" far fa-file-alt  btn flat btn-info dataFormSubmit  btn-sm  ">
                    保存
                </button>
                &nbsp;
                <button class="btn btn-sm btn-default layer-close">關閉</button>
            </div>

        </section>


        {/block}

        {block name="js"}

        <script type="text/javascript">
            $(function () {
                $("#opportunitie").change(function () {
                    let file = this.fields[0];
                    $("#url").text(file.name)
                })
            })


            $("#opportunitie-submit").click(function () {    // 提交按钮触发事件
                var formAction = $("#opportunitie-form").attr("action");    // 获取 表单的 提交地址
                var formData= $("#opportunitie-form").serializeFiles();
                $.ajax({
                    url         : formAction,
                    data        : formData,
                    cache       : false,
                    contentType : false,
                    processData : false,
                    type        : 'POST',
                    success     : function(data, textStatus, jqXHR) {
                        layer.msg(data['msg']);
                        if (data['code'] == 200) {
                            layer_close()
                            parent.$('#opportunitie-grid').bootstrapTable('refresh')
                            // }
                        }
                    }
                });
            });


            $('.layer-close').on('click', function () {
                parent.layer.closeAll();
            });


        </script>
        {/block}