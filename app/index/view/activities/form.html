Activities.php{extend name='public/popup' /}
{block name='content'}
<section class="content">
    <form class="form-horizontal" id="activity-form" method="post" action="{$act}">

    <input type="hidden" id="id" name="id" value="{$item.id|default=''}">
    <div class="row">
        <div class="col-xs-12 col-sm-12">
            <div class="form-group row">
                <label class="col-sm-2 control-label" for="title">Regarding</label>
                <div class="col-sm-2">
                    <select class="form-control form-control-sm" id="parent_type" name="parent_type">
                        <option value="meeting">Meeting</option>
                        <option value="task">task</option>
                        <option value="call">call</option>
                    </select>
                </div>
                <div class="col-sm-8">
                    <input class="form-control form-control-sm" type="text" id="title" name="title"
                           value="{$item.title|default=''}"
                           placeholder="">
                </div>
            </div>

            <div class="form-group row ">
                <label class="col-sm-2 control-label" for="date_start">Start</label>
                <div class="col-sm-4 pr-4">
                    <input class="form-control form-control-sm datetimePicker" type="text" id="date_start" name="date_start"
                           value="{$item.date_start|default=''}"
                           placeholder="">
                </div>

                <label class="col-sm-2 control-label" for="date_end">End</label>
                <div class="col-sm-4">
                    <input class="form-control form-control-sm datetimePicker" type="text" id="date_end" name="date_end"
                           value="{$item.date_end|default=''}"
                           placeholder="">

                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-2 control-label" for="lead_id">Contact</label>
                <div class="col-sm-10 input-group input-group-sm">
                    <input class="form-control" type="text" id="lead_name" name="lead_name"
                           value="{$item.lead_name|default=''}"
                           placeholder="">
                    <input class="form-control" type="hidden" id="lead_id" name="lead_id"
                           value="{$item.lead_id|default=''}"
                           placeholder="">
                    <div class="input-group-append">
                        <a class="input-group-text qs-lead"  href="javascript:void(0)" ><i class="fas fa-search"></i></a>
                    </div>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-2 control-label" for="description">Location</label>
                <div class="col-sm-10">
                    <input class="form-control form-control-sm" type="text" id="location" name="location"
                           value="{$item.location|default=''}"
                           placeholder="">
                </div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 control-label" for="description">Details</label>
                <div class="col-sm-10">
                                  <textarea class="form-control" id="description" name="description"
                                            size="1"
                                            value=""
                                            placeholder="">{$item.description|default=''}</textarea>
                </div>
            </div>


        </div>
    </div>

    <hr>
    <div class="form-group row">
        <label class="col-sm-2 control-label" for="assigned_user_id">Assigned User</label>
        <div class="col-sm-4">
            <select class="form-control form-control-sm" id="assigned_user_id" name="assigned_user_id" >
                <option value="0">Leo Wong</option>
                <option value="1">Ken Kuo</option>
                <option value="2">Leo Wong</option>
                <option value="3">Luke Tam</option>
                <option value="4">Ron</option>
                <option value="5">Rooky Lo</option>
                <option value="6">Stephanie Lam</option>
                <option value="7">System User</option>
                <option value="8">User1</option>
                <option value="9">User2</option>
                <option value="10">User3</option>
                <option value="11">User4</option>
                <option value="12">Vincent</option>
            </select>
        </div>



        <label class="col-sm-2 control-label" for="visible_for">Visible for</label>
        <div class="col-sm-4">
            <select class="form-control form-control-sm" id="visible_for" name="visible_for">
                <option value="1">Authorised Team</option>
                <option value="0">My Team</option>
                <option value="1">Myself</option>
                <option value="2">All</option>
            </select>
        </div>


    </div>
    <hr>
    <div class="col-sm-12" align="center">
        <button id="activity-submit" type="button" class=" far fa-file-alt  btn flat btn-info dataFormSubmit  btn-sm">
            Save
        </button>
        &nbsp;
        <button class="btn btn-default btn-sm btn-close" type="button">Close</button>
    </div>
<br>
    </form>
</section>
{/block}

{block name="js"}
<script type="text/javascript">

    $(function () {

        $("#activity-submit").click(function(){    // 提交按钮触发事件
            var tourl = $("#activity-form").attr("action");    // 获取 表单的 提交地址
            // 序列化 表单数据
            $.post(tourl,$("#activity-form").serialize(),function(data){
                layer.msg(data['msg']);
                if(data['code'] == 200){
                    var action = data['action']
                    parent.layer.closeAll();
                    if(action == 'add') {
                        parent.calendar.addEvent(data.event);
                    }else if(action == "update"){
                        parent.calendar.getEventById(data.event.id).remove()
                        parent.calendar.addEvent(data.event);
                    }else{
                        parent.$('#activity-grid').bootstrapTable('refresh')
                    }
                }
            });
        });


        $('#activity-delete').click(function () {
            var id = $(this).attr('data-id');
            var url = "{:url('activities/del')}?id=" + id
            $.post(url, function (data) {
                layer.msg(data['info']);
                if (data['status'] == 1) {
                    parent.layer.closeAll();
                    if ("{act}" == "edit") {
                        parent.$('#calendar').fullCalendar('removeEvents', [data.id]);
                    } else {
                        parent.$('#activity-grid').bootstrapTable('removeByUniqueId', id);
                    }
                }
            })
        })

        $('.btn-close').on('click', function () {
            var index = parent.layer.getFrameIndex(window.name)
            parent.layer.close(index);
        });

    })



</script>
{/block}