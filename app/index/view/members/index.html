{extend name="public/base" /}
{block name='content'}
<!--数据列表页面-->
<section class="content">

    <!--顶部搜索筛选-->
    <div class="row">
        <div class="col-md-2 tools-card">

            <div class="card">
                <div class="card-body table-responsive">

                    <div class="row">
                        <button type="button " class="btn btn-default bg-info btn-sm col-md-12"><i
                                class="fa fa-search"></i> Advanced 搜索
                        </button>
                    </div>
                    <div class="row pt-3">
                        <div class="card card-outline col-md-12" style="box-shadow: none" id="search-group">
                            <div class="card-header">
                                <h3 class="card-title" style="font-size: 1em">查詢組</h3>
                                <div class="card-tools">
                                    <button type="button" class="btn btn-tool" data-card-widget="collapse"><i
                                            class="fas fa-minus"></i>
                                    </button>
                                </div>
                            </div>
                            <!-- /.card-header -->

                            <div class="card-body pt-2">
                                <div class="widget-main">
                                    <div class="cl-list">
                                        <span class="label label-lg label-yellow">團體1</span>
                                    </div>
                                    <div class="cl-list">
                                        <span class="label label-lg label-info">團體1</span>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>



                    <div class="row pt-3">
                        <div class="card card-outline col-md-12"  style="box-shadow: none" id="tags">
                            <div class="card-header">
                                <h3 class="card-title"  style="font-size: 1em">標簽</h3>
                                <div class="card-tools">
                                    <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i>
                                    </button>
                                </div>
                            </div>
                            <!-- /.card-header -->

                            <div class="card-body pt-2">
                                <div class="widget-main">
                                    <div class="cl-list">
                                        <span class="label label-lg label-yellow">標簽1</span>
                                    </div>
                                    <div class="cl-list">
                                        <span class="label label-lg label-info">標簽2</span>
                                    </div>
                                    <div class="cl-list">
                                        <span class="label label-lg label-success">標簽2</span>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div class="col-md-10 list-card">
            <div class="essentials-toggle" title="Left Panel Show/Hide">
                <span class="essentials-toggle-marker fa cursorPointer fa-chevron-left switch-tools"></span>
            </div>
            <div class="card">
                <div class="card-body table-responsive table-sm">
                    <div id="contacts-toolbar">
                        <a title="Add" class="btn btn-primary btn-sm " href="{:url('add')}">
                            <i class="fa fa-plus"></i> 新增
                        </a>
                        <input type="hidden" value="0" id="export_data" name="export_data">
                        <div class="btn-group">
                            <button type="button " class="btn  btn-success btn-sm"> <i class="fa fa-whatsapp"></i> Whatsapp</button>
                            <button type="button" class="btn btn-success btn-sm dropdown-toggle " data-toggle="dropdown">
                                <span class="sr-only">切換下啦</span>
                                <div class="dropdown-menu" role="menu">
                                    <a class="dropdown-item" href="#">郵箱</a>
                                    <a class="dropdown-item" href="#">SMS</a>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item" href="#">跟随</a>
                                    <a class="dropdown-item" href="#">Un-Follow</a>
                                    <a class="dropdown-item" href="#">Add-標籤</a>
                                </div>
                            </button>
                        </div>

                        <div class="btn-group">
                            <button type="button " class="btn  btn-default btn-sm">更多</button>
                            <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">
                                <span class="sr-only">切換下啦</span>
									<div class="dropdown-menu" role="menu">
                                    <a class="dropdown-item" href="#">查找重複</a>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item exportData"  onclick="$('#export_data').val(1)">匯出</a>
                                    <a class="dropdown-item importData" href="#">導入</a>
                               
                                </div>
                            </button>
                        </div>

                        <input type="file" id="file" class="hidden">

                    </div>
                    <table id="contacts-grid" class="table-striped ">
                        <thead>
                        <tr>
                            <th data-field="check_status" data-checkbox="true"></th>
                            <th data-field="member_no" data-sortable="true" data-filter-control="input" data-width="120">編號</th>
                            <th data-field="first_name" data-sortable="true" data-filter-control="input" data-formatter="showFm">名稱(英文)</th>
                            <th data-field="last_name" data-sortable="true" data-filter-control="input">名稱(中文)</th>
                            <th data-field="opt" data-sortable="true" data-filter-control="input">分類</th>
                            <th data-field="phone_mobile" data-sortable="true" data-filter-control="input">手提電話</th>
                            <th data-field="department" data-sortable="true" data-visible="false" data-filter-control="input">住宅電話</th>
                            <th data-field="salutation" data-sortable="true" data-visible="false" data-filter-control="input">性別</th>
                            <th data-field="birthdate" data-sortable="true" data-visible="false" data-filter-control="input">加入日期</th>
                        </tr>
                        </thead>
                    </table>
                </div>

                <!-- 数据列表底部 -->
                <div class="card-footer">

                </div>

            </div>
        </div>
    </div>
</section>
{/block}

{block name='js'}
<script>

    function showFm(value, row){
        var show_url = "{:url('detail')}?id="+row.id
        var html = '<a href='+show_url+'>'+value+'</a>'
        return html;
    }

    $(function(){
        $('#contacts-grid').bootstrapTable({
            url: 'lists',
            toolbar: "#contacts-toolbar",
            pagination: true,
            sidePagination:'server',
            buttonsClass:"btn-sm btn btn-sm btn-default",
            striped: true,
            cookie: true,
            cookieIdTable: 'contacts-Grid',
            showRefresh: true,
            showColumns: true,
            clickToSelect: true,
            stickyHeader: true,
            stickyHeaderOffsetLeft: '3em',
            stickyHeaderOffsetRight: '3em',
            filterControl: true,
            pageSize: 10,
            pageList: [10, 20, 50, 100],
            onCheck: function(row,ele){
                $.get('contacts/check_one',{opt:'checked',id: row.id},function(data){
                    display_selected(data);
                })
            },
            onUncheck: function(row,ele){
                $.get('contacts/check_one',{opt:'unchecked',id: row.id},function(data){
                    display_selected(data);
                })
            },
            onCheckAll: function(rows){
                $.get('contacts/check_all',{opt:'checked'},function(data){
                    display_selected(data);
                })
            },
            onUncheckAll: function(rows){
                $.get('contacts/check_all',{opt:'unchecked'},function(){
                    display_selected(0);
                })
            }
        });

        $('.btn-search').click(function(){
            $.cookie('accountGrid.bs.table.pageNumber',1);
            //$.post('leads/clear_session',{component:'lead'})
        });


        $(".importData").click(function () {
            $("#file").click()
        })

        $(document).on('change', '#file', function () {
            let formData = new FormData();
            formData.append('file', $(this)[0].files[0]);
            // console.log($(this)[0].files[0])
            $.ajax({
                url: "{:url('import_data')}",
                dataType: 'json',
                type: 'POST',
                async: false,
                data: formData,
                processData : false, // 使数据不做处理
                contentType : false, // 不要设置Content-Type请求头
                success: function(res){
                    if (res.code == 200) {
                        if (res.usersExits != '') {
                            layer.msg('Excel中以下會員編號已存在:'+res.usersExits);
                        }else{
                            layer.msg('success');
                        }
                        $("#contacts-grid").bootstrapTable('refresh');
                    }else {
                        layer.msg(res.msg);
                    }
                }
            })
        })
    })

</script>
{/block}
